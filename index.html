<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fajar & Prita Planner 2.0</title>

    <style>
        body {
            font-family: Arial;
            background: linear-gradient(135deg, #ffdde1, #ee9ca7);
            padding: 15px;
            margin: 0;
        }

        .container {
            max-width: 1100px;
            margin: auto;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: 0.3s;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        h2 {
            text-align: center;
        }

        .category {
            margin-top: 20px;
            padding: 15px;
            background: #f7f7f7;
            border-radius: 15px;
        }

        .task {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .task span {
            flex: 1;
            margin-left: 8px;
            word-break: break-word;
        }

        .done {
            text-decoration: line-through;
            color: gray;
        }

        input[type="text"] {
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            margin-top: 5px;
            margin-bottom: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        button {
            padding: 7px 10px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 5px;
        }

        .add-btn {
            background: #ff6b81;
            color: white;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
        }

        .edit-btn {
            background: #1e90ff;
            color: white;
        }

        .category-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* ðŸ”¥ RESPONSIVE */
        @media(max-width:768px) {

            .task {
                flex-direction: column;
                align-items: flex-start;
            }

            .task span {
                margin: 5px 0;
            }

            button {
                width: 100%;
                margin-bottom: 5px;
            }

        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .gallery img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 15px;
            transition: 0.3s;
            cursor: pointer;
        }

        .gallery img:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body>

    <div class="container">

        <h2>ðŸ’– Fajar & Prita Planner ðŸ’–</h2>

        <div id="app"></div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            getDocs,
            updateDoc,
            deleteDoc,
            doc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBYotQIufCWXIPhrA-DyQpxStDsfz8kSi4",
            authDomain: "fajarprita-2b216.firebaseapp.com",
            projectId: "fajarprita-2b216",
            storageBucket: "fajarprita-2b216.firebasestorage.app",
            messagingSenderId: "867641668763",
            appId: "1:867641668763:web:9cec4f97de3cdfc571023e",
            measurementId: "G-X0MX9W204B"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const people = ["Fajar", "Prita"];
        const appDiv = document.getElementById("app");

        async function loadData() {
            appDiv.innerHTML = "";
            const snapshot = await getDocs(collection(db, "planner"));

            const grouped = {};

            snapshot.forEach(docSnap => {
                const d = docSnap.data();
                if (!grouped[d.person]) grouped[d.person] = {};
                if (!grouped[d.person][d.category]) grouped[d.person][d.category] = [];
                grouped[d.person][d.category].push({ id: docSnap.id, ...d });
            });

            people.forEach(person => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `<h3>${person}</h3>
    <input type="text" placeholder="Nama kategori baru..." id="cat-${person}">
    <button class="add-btn" onclick="addCategory('${person}')">Tambah Kategori</button>
    `;

                const categories = grouped[person] || {};

                Object.keys(categories).forEach(cat => {
                    const catDiv = document.createElement("div");
                    catDiv.className = "category";
                    catDiv.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
        <div class="category-title">${cat}</div>
        <div>
            <button class="edit-btn" onclick="editCategory('${person}','${cat}')">Edit</button>
            <button class="delete-btn" onclick="deleteCategory('${person}','${cat}')">Delete</button>
        </div>
    </div>

    <input type="text" placeholder="Tambah task..." id="task-${person}-${cat}">
    <button class="add-btn" onclick="addTask('${person}','${cat}')">Tambah</button>
`;

                    categories[cat].forEach(task => {
                        const taskDiv = document.createElement("div");
                        taskDiv.className = "task";

                        const checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.checked = task.completed;

                        const span = document.createElement("span");
                        span.textContent = task.text;
                        if (task.completed) span.classList.add("done");

                        checkbox.addEventListener("change", async () => {
                            await updateDoc(doc(db, "planner", task.id), {
                                completed: checkbox.checked
                            });
                            span.classList.toggle("done");
                        });

                        const editBtn = document.createElement("button");
                        editBtn.textContent = "Edit";
                        editBtn.className = "edit-btn";
                        editBtn.onclick = async () => {
                            const newText = prompt("Edit task:", task.text);
                            if (newText) {
                                await updateDoc(doc(db, "planner", task.id), { text: newText });
                                loadData();
                            }
                        };

                        const deleteBtn = document.createElement("button");
                        deleteBtn.textContent = "Delete";
                        deleteBtn.className = "delete-btn";
                        deleteBtn.onclick = async () => {
                            await deleteDoc(doc(db, "planner", task.id));
                            loadData();
                        };

                        taskDiv.appendChild(checkbox);
                        taskDiv.appendChild(span);
                        taskDiv.appendChild(editBtn);
                        taskDiv.appendChild(deleteBtn);

                        catDiv.appendChild(taskDiv);
                    });

                    card.appendChild(catDiv);
                });

                appDiv.appendChild(card);
            });
        }

        window.addCategory = async function (person) {
            const input = document.getElementById("cat-" + person);
            if (!input.value.trim()) return;

            await addDoc(collection(db, "planner"), {
                person: person,
                category: input.value,
                text: "(Kategori dibuat)",
                completed: false,
                createdAt: new Date()
            });

            input.value = "";
            loadData();
        };

        window.addTask = async function (person, category) {
            const input = document.getElementById(`task-${person}-${category}`);
            if (!input.value.trim()) return;

            await addDoc(collection(db, "planner"), {
                person: person,
                category: category,
                text: input.value,
                completed: false,
                createdAt: new Date()
            });

            input.value = "";
            loadData();
        };

        window.editCategory = async function(person, oldCategory){

    const newCategory = prompt("Ubah nama kategori:", oldCategory);
    if(!newCategory || newCategory === oldCategory) return;

    const snapshot = await getDocs(collection(db, "planner"));

    const promises = [];

    snapshot.forEach(docSnap=>{
        const data = docSnap.data();
        if(data.person === person && data.category === oldCategory){
            promises.push(
                updateDoc(doc(db,"planner",docSnap.id),{
                    category: newCategory
                })
            );
        }
    });

    await Promise.all(promises);
    loadData();
};

window.deleteCategory = async function(person, category){

    const confirmDelete = confirm("Hapus kategori dan semua task di dalamnya?");
    if(!confirmDelete) return;

    const snapshot = await getDocs(collection(db, "planner"));

    const promises = [];

    snapshot.forEach(docSnap=>{
        const data = docSnap.data();
        if(data.person === person && data.category === category){
            promises.push(
                deleteDoc(doc(db,"planner",docSnap.id))
            );
        }
    });

    await Promise.all(promises);
    loadData();
};


        loadData();
    </script>

    <div class="card">
        <h3 style="text-align:center;">ðŸ“¸ Our Memories ðŸ’–</h3>

        <div class="gallery">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto1">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto2">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto3">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto4">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto5">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto6">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto7">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto8">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto9">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto10">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto11">
            <img src="foto/FOTO FAJAR SIDIK.jpg" alt="foto12">
        </div>
    </div>
</body>

</html>
